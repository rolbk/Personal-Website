<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Heislberg: The Internet of Toilets &#183; [blog@rolbk.com]#</title><meta name=title content="Heislberg: The Internet of Toilets &#183; [blog@rolbk.com]#"><meta name=description content="How I used an ESP, Magnets and Kubernetes and to solve the great toilet crisis of 2021. A tale of absolutely necessary workplace optimization."><meta name=keywords content="IoT,ESPHome,MQTT,Office Automation,Toilets,Questionable Life Choices,"><link rel=canonical href=https://rolbk.com/posts/iot4-heislberg/><link type=text/css rel=stylesheet href=/css/main.bundle.min.db15651319416dc23c09716c6bfad333663de46f0b1634dd77228e3d4e350ca3fbb38193699e7e36ded41b245e010f69c5d8428ef1646be3b37248366e6ee201.css integrity="sha512-2xVlExlBbcI8CXFsa/rTM2Y95G8LFjTddyKOPU41DKP7s4GTaZ5+Nt7UGyReAQ9pxdhCjvFka+Ozckg2bm7iAQ=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.a187118b41a60744310065c567365de85730c8495301d0ebae41810cc6f7a47432b1de7d4f3b11338959f1ac50c266be6b4b73acf6bf770016eb59b602cc1aa0.js integrity="sha512-oYcRi0GmB0QxAGXFZzZd6FcwyElTAdDrrkGBDMb3pHQysd59TzsRM4lZ8axQwma+a0tzrPa/dwAW61m2AswaoA==" data-copy=Copy data-copied=Copied></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://rolbk.com/posts/iot4-heislberg/"><meta property="og:site_name" content="[blog@rolbk.com]#"><meta property="og:title" content="Heislberg: The Internet of Toilets"><meta property="og:description" content="How I used an ESP, Magnets and Kubernetes and to solve the great toilet crisis of 2021. A tale of absolutely necessary workplace optimization."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-15T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-15T00:00:00+00:00"><meta property="article:tag" content="IoT"><meta property="article:tag" content="ESPHome"><meta property="article:tag" content="MQTT"><meta property="article:tag" content="Office Automation"><meta property="article:tag" content="Toilets"><meta property="article:tag" content="Questionable Life Choices"><meta property="og:image" content="https://rolbk.com/posts/iot4-heislberg/featured.webp"><meta property="og:see_also" content="https://rolbk.com/posts/iot3-door/"><meta property="og:see_also" content="https://rolbk.com/posts/iot2-window/"><meta property="og:see_also" content="https://rolbk.com/posts/iot1-sofa/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rolbk.com/posts/iot4-heislberg/featured.webp"><meta name=twitter:title content="Heislberg: The Internet of Toilets"><meta name=twitter:description content="How I used an ESP, Magnets and Kubernetes and to solve the great toilet crisis of 2021. A tale of absolutely necessary workplace optimization."><meta name=twitter:image content="https://rolbk.com/posts/iot4-heislberg/featured.webp"><meta property="og:image" content="https://rolbk.com/posts/iot4-heislberg/featured.webp"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Heislberg: The Internet of Toilets","headline":"Heislberg: The Internet of Toilets","abstract":"How I used an ESP, Magnets and Kubernetes and to solve the great toilet crisis of 2021. A tale of absolutely necessary workplace optimization.","inLanguage":"en","url":"https:\/\/rolbk.com\/posts\/iot4-heislberg\/","author":{"@type":"Person","name":"Emanuel Mairoll"},"copyrightYear":"2024","dateCreated":"2024-11-15T00:00:00\u002b00:00","datePublished":"2024-11-15T00:00:00\u002b00:00","dateModified":"2024-11-15T00:00:00\u002b00:00","keywords":["IoT","ESPHome","MQTT","Office Automation","Toilets","Questionable Life Choices"],"mainEntityOfPage":"true","wordCount":"3120"}]</script><meta name=author content="Emanuel Mairoll"><link href=https://github.com/rolbk/ rel=me><link href=https://www.linkedin.com/in/rolbk/ rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px] z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 pt-[2px] pr-0 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">[blog@rolbk.com]#</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Posts>Posts</p></a><a href=/projects/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title="Under Construction ;-)">Projects</p></a><a href=/resume/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Resume>Resume</p></a><a href=/posts/index.xml class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 64C0 46.3 14.3 32 32 32c229.8.0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7.0 64zM128 416c0 35.3-28.7 64-64 64S0 451.3.0 416s28.7-64 64-64 64 28.7 64 64zM32 160c159.1.0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7.0-32-14.3-32-32s14.3-32 32-32z"/></svg></span></span><p class="text-base font-medium" title></p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Posts>Posts</p></a></li><li class=mt-1><a href=/projects/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title="Under Construction ;-)">Projects</p></a></li><li class=mt-1><a href=/resume/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Resume>Resume</p></a></li><li class=mt-1><a href=/posts/index.xml class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 64C0 46.3 14.3 32 32 32c229.8.0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7.0 64zM128 416c0 35.3-28.7 64-64 64S0 451.3.0 416s28.7-64 64-64 64 28.7 64 64zM32 160c159.1.0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7.0-32-14.3-32-32s14.3-32 32-32z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li></ul></div></div></div></div></div></div><script type=text/javascript src=/js/background-blur.min.0ad33cb9c066f652728b2cc09c9ceaf32645544f48e8b6b38f120d86f433ed997da275a49e6151fe0176430c45376812708d84727f3f969101fb44a4345b3f34.js integrity="sha512-CtM8ucBm9lJyiyzAnJzq8yZFVE9I6LazjxINhvQz7Zl9onWknmFR/gF2QwxFN2gScI2Ecn8/lpEB+0SkNFs/NA==" data-target-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src=/posts/iot4-heislberg/featured_hu_9b693e9e90c315ce.webp alt="Background Image" class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script type=text/javascript src=/js/background-blur.min.0ad33cb9c066f652728b2cc09c9ceaf32645544f48e8b6b38f120d86f433ed997da275a49e6151fe0176430c45376812708d84727f3f969101fb44a4345b3f34.js integrity="sha512-CtM8ucBm9lJyiyzAnJzq8yZFVE9I6LazjxINhvQz7Zl9onWknmFR/gF2QwxFN2gScI2Ecn8/lpEB+0SkNFs/NA==" data-target-id=background-blur data-image-id=background-image data-image-url=/posts/iot4-heislberg/featured.webp></script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Heislberg: The Internet of Toilets</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2024-11-15T00:00:00+00:00>15 November 2024</time><span class="px-2 text-primary-500">&#183;</span><span>3120 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">15 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] mr-2" href=/tags/iot/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">IoT
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/esphome/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">ESPHome
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/mqtt/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">MQTT
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/office-automation/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Office Automation
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/toilets/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Toilets
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/questionable-life-choices/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Questionable Life Choices</span></span></a></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#the-great-toilet-crisis-of-2021>The Great Toilet Crisis of 2021</a></li><li><a href=#standing-on-the-shoulders-of-giants-who-got-told-off>Standing on the Shoulders of Giants (Who Got Told Off)</a></li><li><a href=#the-failed-experiments-hall-of-fame>The Failed Experiments Hall of Fame</a><ul><li><a href=#attempt-1-the-movement-sensor-hijack>Attempt #1: The Movement Sensor Hijack</a></li><li><a href=#attempt-2-the-obvious-box-20>Attempt #2: The Obvious Box 2.0</a></li><li><a href=#attempt-3-door-surgery>Attempt #3: Door Surgery</a></li></ul></li><li><a href=#the-breakthrough-magnetic-fields-dont-lie>The Breakthrough: Magnetic Fields Don&rsquo;t Lie</a><ul><li><a href=#the-proof-of-concept>The Proof of Concept</a></li></ul></li><li><a href=#the-heislberg-uncertainty-principle>The Heislberg Uncertainty Principle</a><ul><li><a href=#the-hardware>The Hardware</a></li><li><a href=#the-installation>The Installation</a></li></ul></li><li><a href=#the-toilet-data-pipeline>The Toilet (Data) Pipeline</a><ul><li><a href=#the-edge-device>The &ldquo;Edge Device&rdquo;</a></li><li><a href=#mqtt-server>MQTT server</a></li><li><a href=#janus-data-processing>Janus: Data Processing</a></li></ul></li><li><a href=#the-many-visualizations-the-part-where-we-kinda-lost-control>The Many Visualizations (The Part Where We Kinda Lost Control)</a><ul><li><a href=#company-dashboard>Company Dashboard</a></li><li><a href=#menu-bar-apps>Menu Bar Apps</a></li><li><a href=#random-esps>Random ESPs</a></li><li><a href=#the-on-air-sign>The ON AIR Sign</a></li></ul></li><li><a href=#the-legacy>The Legacy</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#the-great-toilet-crisis-of-2021>The Great Toilet Crisis of 2021</a></li><li><a href=#standing-on-the-shoulders-of-giants-who-got-told-off>Standing on the Shoulders of Giants (Who Got Told Off)</a></li><li><a href=#the-failed-experiments-hall-of-fame>The Failed Experiments Hall of Fame</a><ul><li><a href=#attempt-1-the-movement-sensor-hijack>Attempt #1: The Movement Sensor Hijack</a></li><li><a href=#attempt-2-the-obvious-box-20>Attempt #2: The Obvious Box 2.0</a></li><li><a href=#attempt-3-door-surgery>Attempt #3: Door Surgery</a></li></ul></li><li><a href=#the-breakthrough-magnetic-fields-dont-lie>The Breakthrough: Magnetic Fields Don&rsquo;t Lie</a><ul><li><a href=#the-proof-of-concept>The Proof of Concept</a></li></ul></li><li><a href=#the-heislberg-uncertainty-principle>The Heislberg Uncertainty Principle</a><ul><li><a href=#the-hardware>The Hardware</a></li><li><a href=#the-installation>The Installation</a></li></ul></li><li><a href=#the-toilet-data-pipeline>The Toilet (Data) Pipeline</a><ul><li><a href=#the-edge-device>The &ldquo;Edge Device&rdquo;</a></li><li><a href=#mqtt-server>MQTT server</a></li><li><a href=#janus-data-processing>Janus: Data Processing</a></li></ul></li><li><a href=#the-many-visualizations-the-part-where-we-kinda-lost-control>The Many Visualizations (The Part Where We Kinda Lost Control)</a><ul><li><a href=#company-dashboard>Company Dashboard</a></li><li><a href=#menu-bar-apps>Menu Bar Apps</a></li><li><a href=#random-esps>Random ESPs</a></li><li><a href=#the-on-air-sign>The ON AIR Sign</a></li></ul></li><li><a href=#the-legacy>The Legacy</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><details class="mt-2 mb-5 overflow-hidden rounded-lg ltr:ml-0 ltr:pl-5 rtl:mr-0 rtl:pr-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">The Open Source Smart Home -
This article is part of a series.</summary><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot1-sofa/>Part 1:
The Internet of Furniture</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot2-window/>Part 2:
The Internet of Roof Windows</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot3-door/>Part 3:
The Internet of Entrance Doors</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">Part 4:
This Article</div></details><div class="article-content max-w-prose mb-20"><p>Oh boy, do I love stupid projects. And oh boy, do I love IoT. But most of all, I love solving minuscule problems in absolutely ridiculous ways.</p><p>So, this is the story of how I used an ESP, Magnets and Kubernetes to solve the great toilet crisis of 2021.</p><blockquote><p>I would have written this article far sooner, as it was my first contact with the IoT stack that I kept using for other (and more useful) home automation projects. However, some colleagues kept muttering about &ldquo;privacy concerns&rdquo; and &ldquo;professional boundaries.&rdquo;<br>But now that enough time has passed, I hope I can finally freely share this tale of absolutely necessary workplace optimization.</p></blockquote><p><strong><em>Stories from the Open Source Smart Home (Office) - Part 4</em></strong></p><hr><h2 class="relative group">The Great Toilet Crisis of 2021<div id=the-great-toilet-crisis-of-2021 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-great-toilet-crisis-of-2021 aria-label=Anchor>#</a></span></h2><p>Picture this: A thriving tech company. Twenty-something male engineers. One toilet stall.</p><p>You can see where this is going.</p><p>The daily dance was predictable: You&rsquo;d feel nature&rsquo;s call, walk to the bathroom with confidence, only to find the stall occupied. Then came the walk of shame back to your desk, where you&rsquo;d sit and wonder, &ldquo;Is it free yet? Should I check again? How long is too long to wait?&rdquo;</p><p>The real problem wasn&rsquo;t the single stall. It was the <em>uncertainty</em>. You&rsquo;d walk all the way to the bathroom (a whole 20 meters!), find it occupied, and then have to walk ALL THE WAY BACK to your desk. That&rsquo;s 40 meters of completely unnecessary locomotion. Multiply that by 20 engineers, several times a day, and we&rsquo;re talking about kilometers of wasted movement.</p><p>We were engineers. We had Git workflows more sophisticated than NASA&rsquo;s launch protocols. We had CI/CD pipelines that would make DevOps consultants weep tears of joy. But we couldn&rsquo;t figure out if the toilet was free without physically walking there.</p><p>Obviously, this was unacceptable.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="toilet stall" srcset="/posts/iot4-heislberg/toilet_stall_hu_a7d7a2cd4c24ab67.webp 330w,
/posts/iot4-heislberg/toilet_stall_hu_b8e0ea22b94dcef8.webp 660w,
/posts/iot4-heislberg/toilet_stall_hu_b2d39425433d77a.webp 1280w" data-zoom-src=/posts/iot4-heislberg/toilet_stall.webp src=/posts/iot4-heislberg/toilet_stall.webp></figure></p><h2 class="relative group">Standing on the Shoulders of Giants (Who Got Told Off)<div id=standing-on-the-shoulders-of-giants-who-got-told-off class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#standing-on-the-shoulders-of-giants-who-got-told-off aria-label=Anchor>#</a></span></h2><p>I wasn&rsquo;t the first to recognize this engineering emergency. Some brave colleagues had already installed a prototype back in the old office - a suspiciously large box mounted on the toilet stall that screamed &ldquo;SURVEILLANCE DEVICE&rdquo; to anyone within a 10-meter radius.</p><p>It worked perfectly - for exactly three days, before the CEO asked them to take it down. Something about &ldquo;professionalism&rdquo; and &ldquo;what will investors think.&rdquo;</p><blockquote><p>Sad engineering noises.</p></blockquote><p>But as the team grew and the toilet traffic increased, the problem became impossible to ignore.</p><p>And I had spare evenings.</p><h2 class="relative group">The Failed Experiments Hall of Fame<div id=the-failed-experiments-hall-of-fame class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-failed-experiments-hall-of-fame aria-label=Anchor>#</a></span></h2><h3 class="relative group">Attempt #1: The Movement Sensor Hijack<div id=attempt-1-the-movement-sensor-hijack class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#attempt-1-the-movement-sensor-hijack aria-label=Anchor>#</a></span></h3><p>The toilet had an existing PIR sensor that controlled the lights. &ldquo;Perfect,&rdquo; I thought, &ldquo;I&rsquo;ll just tap into that.&rdquo;</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="open sensor" srcset="/posts/iot4-heislberg/sensor_hu_caf5c8418556a251.webp 330w,
/posts/iot4-heislberg/sensor_hu_2da59e397c1212b4.webp 660w,
/posts/iot4-heislberg/sensor_hu_dc2dc225056f05b4.webp 1280w" data-zoom-src=/posts/iot4-heislberg/sensor.webp src=/posts/iot4-heislberg/sensor.webp></figure></p><p>I ordered the exact same model from Amazon, cracked it open, and found just enough space for a TinyPICO, one of the smallest ESP32 boards available at the time. The plan was elegant: intercept the sensor signal, broadcast it, nobody would know.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="toilet stall" srcset="/posts/iot4-heislberg/tinypico_hu_a7e1779eb3d329fa.webp 330w,
/posts/iot4-heislberg/tinypico_hu_30278daaa1285684.webp 660w,
/posts/iot4-heislberg/tinypico_hu_6a3f8a50f7d32170.webp 1280w" data-zoom-src=/posts/iot4-heislberg/tinypico.webp src=/posts/iot4-heislberg/tinypico.webp></figure></p><p>Then I noticed the sensor ran on mains voltage. 230V AC. In a box of about 5 cm size. A sane person would have thought: &ldquo;Hmm, shoving additional electronics into a mains-powered device that sits in a bathroom is probably a terrible idea. The risk of causing a short circuit that burns down the office or even kills someone is too high.&rdquo;</p><p>But I&rsquo;m not a sane person. I&rsquo;m an engineer with a mission.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="open sensor" srcset="/posts/iot4-heislberg/sensor_internals_hu_97a5b2b1905992a3.webp 330w,
/posts/iot4-heislberg/sensor_internals_hu_2175f76611704799.webp 660w,
/posts/iot4-heislberg/sensor_internals_hu_574929e054fbb865.webp 1280w" data-zoom-src=/posts/iot4-heislberg/sensor_internals.webp src=/posts/iot4-heislberg/sensor_internals.webp></figure></p><p>So naturally, I had the sensor open, ready to reverse engineer. Connected to mains power of course, to be able to map out the voltages. Set up my workbench, got my multimeter ready, carefully mapped out the circuit. I was being <em>so</em> professional about it. Right up until the moment I accidentally touched the wrong part with my screwdriver.</p><p><em>230V AC straight into my hand.</em></p><p>The muscles in my arm did that fun involuntary contraction thing. The screwdriver went flying. The GFCI triggered. Several German words were invented.</p><blockquote><p>Ouch.</p></blockquote><p>Ok ok&mldr; Lession learned&mldr; Moving on.</p><h3 class="relative group">Attempt #2: The Obvious Box 2.0<div id=attempt-2-the-obvious-box-20 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#attempt-2-the-obvious-box-20 aria-label=Anchor>#</a></span></h3><p>I considered recreating my colleagues&rsquo; box design but making it smaller and less conspicuous.</p><p>After trying every possible mounting position, I however concluded that any external box would still look like we were filming a very specific genre of content.</p><p>Back to the drawing board.</p><h3 class="relative group">Attempt #3: Door Surgery<div id=attempt-3-door-surgery class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#attempt-3-door-surgery aria-label=Anchor>#</a></span></h3><p>Maybe I could hide something in the door frame itself?</p><p>I spent an entire evening with my toolbox spread across the bathroom floor. First, I removed the entire lock mechanism from the door. Then I disassembled it completely, every single spring and pin laid out on paper towels like I was performing mechanical surgery.</p><p><strong>The good news:</strong> I found space inside the door frame cavity.<br><strong>The bad news:</strong> There was no way to get power there without visible cables.<br><strong>The worse news:</strong> I had to reassemble a door lock with mysterious leftover screws.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="door surgery" srcset="/posts/iot4-heislberg/door_surgery_hu_7368b44ee91197ed.webp 330w,
/posts/iot4-heislberg/door_surgery_hu_b5d52adccdc52cc2.webp 660w,
/posts/iot4-heislberg/door_surgery_hu_68e41982927ceead.webp 1280w" data-zoom-src=/posts/iot4-heislberg/door_surgery.webp src=/posts/iot4-heislberg/door_surgery.webp></figure><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="door surgery internals" srcset="/posts/iot4-heislberg/door_surgery_internals_hu_914609de3152186e.webp 330w,
/posts/iot4-heislberg/door_surgery_internals_hu_fbaacb22dc7605b9.webp 660w,
/posts/iot4-heislberg/door_surgery_internals_hu_a8b19946bf9d89e6.webp 1280w" data-zoom-src=/posts/iot4-heislberg/door_surgery_internals.webp src=/posts/iot4-heislberg/door_surgery_internals.webp></figure></p><h2 class="relative group">The Breakthrough: Magnetic Fields Don&rsquo;t Lie<div id=the-breakthrough-magnetic-fields-dont-lie class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-breakthrough-magnetic-fields-dont-lie aria-label=Anchor>#</a></span></h2><p>Remember playing with magnets and compasses as a kid? Magnet goes near compass, needle moves - basic physics that every 8-year-old knows. Take that same setup, and wiggle a piece of iron between them - the needle reacts. The magnetic field lines are &ldquo;pulled into&rdquo; the magnetic conductor, which changes the field the compass sees. Nothing fancy.</p><p>But here&rsquo;s what blew my mind: If you wiggle the iron <em>behind</em> the magnet - so on the opposite side, and quite a bit away from the compass - the needle STILL reacts. The metal behind the magnet changes the field in front of it.</p><p>So, while playing with Hall effect sensors for an unrelated project (I swear), I had an epiphany. The door lock was metal. And magnetic fields&mldr; they go through walls.</p><p>I could detect the door state from <em>inside the wall</em>.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=magnets srcset="/posts/iot4-heislberg/magnets_hu_d8d1ba712fc32fa2.webp 330w,
/posts/iot4-heislberg/magnets_hu_ad8880888c8df997.webp 660w,
/posts/iot4-heislberg/magnets_hu_7916576060350f39.webp 1280w" data-zoom-src=/posts/iot4-heislberg/magnets.webp src=/posts/iot4-heislberg/magnets.webp></figure></p><h3 class="relative group">The Proof of Concept<div id=the-proof-of-concept class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-proof-of-concept aria-label=Anchor>#</a></span></h3><p>I needed to test this theory.</p><p>The wall in question was drywall - specifically, dual drywall that I could access through the hole for the movement sensor (that I&rsquo;d previously electrocuted myself with). I grabbed a Wemos D1 mini I had lying around, connected it to a hall sensor, and attached the whole mess to the end of a ridiculously long USB cable.</p><p>While I dont have a picture of the actual sensor, here is a later revision of what I call a &ldquo;Sensor on a Stick&rdquo;:</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="sensor on a stick" srcset="/posts/iot4-heislberg/sensor_on_a_stick_hu_e750763cf8058179.webp 330w,
/posts/iot4-heislberg/sensor_on_a_stick_hu_d30e80b904209211.webp 660w,
/posts/iot4-heislberg/sensor_on_a_stick_hu_578c366cdca7cf46.webp 1280w" data-zoom-src=/posts/iot4-heislberg/sensor_on_a_stick.webp src=/posts/iot4-heislberg/sensor_on_a_stick.webp></figure></p><p>Then came the funny part: feeding this contraption through the wall cavity. I&rsquo;d deliberately stayed late at the office for this experiment, figuring I&rsquo;d have privacy for my bathroom floor engineering session.</p><p>Of course, that&rsquo;s exactly when a colleague returned to grab his forgotten laptop and found me sitting on the bathroom floor with a USB cable disappearing into the wall.</p><blockquote><p>Should I&mldr; ask?<br>Probably not.<br>Cool. See you tomorrow.</p></blockquote><p>He left. We never spoke of it again.</p><p>Anyways, the sensor ended up roughly where I estimated the strike plate of the door lock would be.</p><p><em>Compass in place. ✅</em></p><p>Next, I placed a neodymium magnet in the strike plate hole, which I could clearly see on the sensor readings behind it in the wall.</p><p><em>Magnet in place. ✅</em></p><p>Then, locked the door in front of me, and&mldr;</p><p>It worked. Not just &ldquo;kind of worked&rdquo; - it worked <em>perfectly</em>.</p><p>The solid metal door lock was a perfect magnetic field conductor. With the magnet positioned just right, I could detect not just whether the door was closed, but even if it was <em>locked</em>. The bolt sliding into place created a completely different magnetic signature - the magnetometer XYZ values changed predictably: door open, door closed, door locked. Three distinct states, all readable from inside the wall.</p><p>It was beautiful. It was elegant. It was completely invisible.</p><p>It needed a name.</p><h2 class="relative group">The Heislberg Uncertainty Principle<div id=the-heislberg-uncertainty-principle class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-heislberg-uncertainty-principle aria-label=Anchor>#</a></span></h2><p>If you were wondering about the posts title&mldr;</p><p>Werner Heisenberg was a German physicist. That means, he definitely had <em>something</em> to do with magnets. Probably.</p><p>I mean, he defenitely did something with uncertanty (of toilet occupancy I guess).</p><p>Plus, &ldquo;Heisl&rdquo; is Austro-Bavarian slang for a small house&mldr; or a toilet.</p><p><em>The joke practically wrote itself.</em></p><p>Anyways, now that the most difficult part of every tech project is done - <em>naming it</em> - I could finally focus on the permanent installation.</p><h3 class="relative group">The Hardware<div id=the-hardware class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-hardware aria-label=Anchor>#</a></span></h3><p>Around this time, my colleague was building his house and kept talking about his DIY home automation setup. He&rsquo;d discovered these OLIMEX ESP32-POE boards which he used all over the system, and he couldn&rsquo;t stop praising them.</p><p>I was intrigued and asked if he could bring me a spare to try out. He did, I plugged it in, and immediately fell in love. The ESP ecosystem has amazing software support in general, the &ldquo;32&rdquo; in it meant enough processing power for anything I could throw at it, and Power over Ethernet meant no suspicious power cables running through the wall.</p><p>Basically: Perfect for toilet monitoring. (Also perfect for my sofa project, but that&rsquo;s yet <a href=/posts/iot1-sofa>another story</a>.)</p><p>For the Hall sensor, I went with the GY-271 HMC5883L - a 3D magnetometer breakout board that was easy to source and had good ESP library support. The only thing to watch out for was I2C&rsquo;s cable length - anything over 1-2 meters and the signal starts getting flaky.</p><h3 class="relative group">The Installation<div id=the-installation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-installation aria-label=Anchor>#</a></span></h3><p>This is where things got interesting. The movement sensor I&rsquo;d unsuccessfully tried to hack earlier? It has to get power from <em>somewhere</em>. The next evening, armed with my cable pull rod, I went spelunking in the office infrastructure.</p><p>Following the cable with my pull rod through the wall cavity and cable conduit led me up into the dropped ceiling. Popping my head up there with a ladder revealed several incredible discoveries:</p><ul><li>My cable pull rod&rsquo;s other end</li><li>An alarming amount of cobwebs</li><li>A patch panel that went directly to our server room (jackpot!)</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="patch panel" srcset="/posts/iot4-heislberg/patch_panel_hu_2511fc2eea433ff.webp 330w,
/posts/iot4-heislberg/patch_panel_hu_b23f910cd5dff3b5.webp 660w,
/posts/iot4-heislberg/patch_panel_hu_51beb8e9fb9c46c1.webp 1280w" data-zoom-src=/posts/iot4-heislberg/patch_panel.webp src=/posts/iot4-heislberg/patch_panel.webp></figure></p><p>I&rsquo;m not saying the building was designed for toilet monitoring, but I&rsquo;m not <em>not</em> saying it either.</p><p>The installation process that followed was surprisingly straightforward:</p><p>First, I pulled a four-conductor telephone cable with pre-soldered terminal connectors (VCC, GND, SCA, SDL) through the existing conduit.</p><p>Next came the delicate operation of shoving the Hall sensor into the wall cavity, positioning it right behind where I&rsquo;d placed a small neodymium magnet in the strike plate hole. The sensor dangled there on its wires like a very expensive spider.</p><p>The ESP32-POE got the royal treatment - plugged into a breadboard that I then mounted to the ceiling infrastructure using the finest installation method known to engineering: double-sided tape.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="ceiling mounted" srcset="/posts/iot4-heislberg/ceiling_mounted_hu_fae2da93b4b9739.webp 330w,
/posts/iot4-heislberg/ceiling_mounted_hu_5169e2c80b2b790d.webp 660w,
/posts/iot4-heislberg/ceiling_mounted_hu_4ad4d83a843611cd.webp 1280w" data-zoom-src=/posts/iot4-heislberg/ceiling_mounted.webp src=/posts/iot4-heislberg/ceiling_mounted.webp></figure></p><p>After connecting the I2C cable from the wall sensor to the ceiling-mounted ESP, I ran an Ethernet cable over to the patch panel. From there, it was a simple hop to the server room where I connected everything to a PoE injector on the guest network (the Network Admin had already given his blessing - he was surprisingly enthusiastic about the whole thing).</p><p>Total time: three hours, mostly spent wondering what I was doing with my life.</p><h2 class="relative group">The Toilet (Data) Pipeline<div id=the-toilet-data-pipeline class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-toilet-data-pipeline aria-label=Anchor>#</a></span></h2><h3 class="relative group">The &ldquo;Edge Device&rdquo;<div id=the-edge-device class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-edge-device aria-label=Anchor>#</a></span></h3><p>The ESP32-POE went through two iterations of firmware. Initially, I wrote it in C++ using libraries for the HMC5883L and MQTT - a simple polling loop that read sensor values and pushed them to the broker. It worked well for the first few weeks, but sometimes the sensor mysteriously got &ldquo;stuck&rdquo; without explanation. With no logs to debug with (because who needs logging?), we suspected a memory leak in one of the libraries. The only fix was a restart, which was particularly annoying when you&rsquo;re trying to maintain toilet monitoring uptime.</p><p>After successfully using ESPHome in other projects, I decided to migrate the Heislberg firmware as well. Not only was YAML configuration less likely to segfault the toilet, but it also provided proper logging and an elegant OTA update mechanism. As a bonus, said update mechanism also enabled us easily performing the occupancy classification directly on the ESP rather than relying on the rest of the pipeline.</p><p>Here&rsquo;s the final ESPHome configuration (which, admittedly, still became much more C++ heavy than anticipated):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>esphome</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>heislberg-wcm</span>
</span></span><span style=display:flex><span><span style=color:#f92672>esp32</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>board</span>: <span style=color:#ae81ff>esp32-poe</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>framework</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>arduino</span>
</span></span><span style=display:flex><span><span style=color:#f92672>logger</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>ota</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>&lt;OTAPASSWORD&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>ethernet</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>LAN8720</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mdc_pin</span>: <span style=color:#ae81ff>GPIO23</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mdio_pin</span>: <span style=color:#ae81ff>GPIO18</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>clk_mode</span>: <span style=color:#ae81ff>GPIO17_OUT</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>phy_addr</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>power_pin</span>: <span style=color:#ae81ff>GPIO12</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>mqtt</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>broker</span>: <span style=color:#ae81ff>&lt;MQTTSERVER&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>binary_sensor</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>gpio</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pin</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>number</span>: <span style=color:#ae81ff>GPIO34</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>inverted</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>id</span>: <span style=color:#ae81ff>button_onboard</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>############################ MAGNET SENSOR ############################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>i2c</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>sda</span>: <span style=color:#ae81ff>GPIO13</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>scl</span>: <span style=color:#ae81ff>GPIO16</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>scan</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>sensor</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>hmc5883l</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>door_sensor</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>field_strength_x</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Field Strength X&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>filters</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>delta</span>: <span style=color:#ae81ff>1.5</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>on_raw_value</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>then</span>: 
</span></span><span style=display:flex><span>          - <span style=color:#f92672>lambda</span>: <span style=color:#e6db74>&#39;id(current_x) = x;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>field_strength_y</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Field Strength Y&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>filters</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>delta</span>: <span style=color:#ae81ff>3.0</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>on_raw_value</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>then</span>: 
</span></span><span style=display:flex><span>          - <span style=color:#f92672>lambda</span>: <span style=color:#e6db74>&#39;id(current_y) = x;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>field_strength_z</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Field Strength Z&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>filters</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>delta</span>: <span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>on_raw_value</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>then</span>: 
</span></span><span style=display:flex><span>          - <span style=color:#f92672>lambda</span>: <span style=color:#e6db74>&#39;id(current_z) = x;&#39;</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>script.execute</span>: <span style=color:#ae81ff>update_door_state</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>oversampling</span>: <span style=color:#ae81ff>4x</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>range</span>: <span style=color:#ae81ff>130uT</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>update_interval</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>2s</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>############################ SENSOR POSTPROCESSING ############################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>text_sensor</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>template</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>door_state</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Door State&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>filters</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>lambda</span>: |-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        if (x == id(door_state).state) {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          return {};
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        } else {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          return x;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>globals</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>current_x</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>float</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restore_value</span>: <span style=color:#66d9ef>no</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>initial_value</span>: <span style=color:#e6db74>&#39;0&#39;</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>current_y</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>float</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restore_value</span>: <span style=color:#66d9ef>no</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>initial_value</span>: <span style=color:#e6db74>&#39;0&#39;</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>current_z</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>float</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restore_value</span>: <span style=color:#66d9ef>no</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>initial_value</span>: <span style=color:#e6db74>&#39;0&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>id</span>: <span style=color:#ae81ff>update_door_state</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>then</span>: 
</span></span><span style=display:flex><span>      - <span style=color:#f92672>lambda</span>: !<span style=color:#ae81ff>lambda |-</span>
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>// static declarations</span>
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>struct xyz {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>std::string name;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>float x;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>float y;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>float z;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>xyz(std::string cname, float cx, float cy, float cz) {</span>
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>name = cname;</span>
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>x = cx;</span>
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>y</span> <span style=color:#ae81ff>= cy;</span>
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>z = cz;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }<span style=color:#ae81ff>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>xyz positions[] = {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>xyz(&#34;open&#34;, -45.2, -96.0, 0.1),</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>xyz(&#34;closed&#34;, -47.3, -101.6, 0.1),</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>xyz(&#34;locked&#34;, -52.0, -125.6, 0.1)</span>
</span></span><span style=display:flex><span>          }<span style=color:#ae81ff>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>// actual updating code</span>
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>xyz current(&#34;current&#34;, id(current_x), id(current_y), id(current_z));</span>
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>float smallest_distance = std::numeric_limits&lt;float&gt;::max();</span>
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>xyz nearest = xyz(&#34;none&#34;, 0, 0, 0);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>for (xyz position</span>: <span style=color:#ae81ff>positions) {</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>float dx = current.x - position.x;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>float dy = current.y - position.y;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>float dz = current.z - position.z;</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>float distance = std::sqrt(dx * dx + dy * dy + dz * dz);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>if (distance &lt; smallest_distance) {</span>
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>smallest_distance = distance;</span>
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>nearest = position;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>id(door_state).publish_state(nearest.name);</span>
</span></span></code></pre></div><h3 class="relative group">MQTT server<div id=mqtt-server class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#mqtt-server aria-label=Anchor>#</a></span></h3><p>Nothing fancy here - just a standard Mosquitto server running in our Kubernetes cluster, deployed specifically for this project (because of course we spun up dedicated infrastructure for toilet monitoring).</p><p>The broker was exposed on the guest network (same network as the ESP32), which made the Network Admin happy since it kept the toilet traffic segregated from production systems. Running it in Kubernetes was probably overkill for a broker handling just a handful of topics (magnetic field XYZ values, door state, and the occasional diagnostic message), but hey - if you&rsquo;re going to over-engineer a toilet sensor, you might as well give it enterprise-grade message queuing. Plus, automatic restarts meant we&rsquo;d never lose toilet telemetry due to a crashed broker. Priorities.</p><h3 class="relative group">Janus: Data Processing<div id=janus-data-processing class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#janus-data-processing aria-label=Anchor>#</a></span></h3><p>Before migrating to ESPHome and its convenient OTA updates, we wanted to decouple the sensor data from the classification logic (because that&rsquo;s what you do when you&rsquo;re definitely not over-engineering). The idea was to avoid having to reflash the firmware if the magnetic field values ever changed - which would require more ceiling spelunking to physically access the ESP32.</p><p>Enter Janus, a small Go microservice that acts as the central hub for all toilet data:</p><ul><li>Subscribes to raw XYZ magnetic field values</li><li>Classifies these positions in 3D space (open/closed/locked) using thresholds</li><li>Exposes toilet status via HTTP endpoints</li><li>Reports metrics to Datadog (because we needed toilet analytics, apparently)</li><li>Runs in Kubernetes for high availability (obviously)</li></ul><p>The name? Janus is the Roman god of doors and transitions. Also, it sounds like&mldr; well, you get it. We&rsquo;re professionals here.</p><p>As described above, we later dropped the classification part and moved it to the edge device, but Janus remained the central hub for data format conversions and API endpoints. Never waste a good pun-based microservice name!</p><h2 class="relative group">The Many Visualizations (The Part Where We Kinda Lost Control)<div id=the-many-visualizations-the-part-where-we-kinda-lost-control class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-many-visualizations-the-part-where-we-kinda-lost-control aria-label=Anchor>#</a></span></h2><h3 class="relative group">Company Dashboard<div id=company-dashboard class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#company-dashboard aria-label=Anchor>#</a></span></h3><p>We added the toilet metrics to our main Datadog dashboard, right between API response times and Kubernetes pod health. The Datadog gauge was a bit slow to react though, so we hacked together a small dashboard embed fed by Janus for real-time updates. A highlight at every weekly tech sync.</p><h3 class="relative group">Menu Bar Apps<div id=menu-bar-apps class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#menu-bar-apps aria-label=Anchor>#</a></span></h3><p>I also wrote a small Swift app for macOS that lived in the menu bar. A tiny toilet icon with either a red or green dot. It could even send notifications when the toilet became free!</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=menuqttool srcset="/posts/iot4-heislberg/menuqttool_hu_88aead43a825055c.png 330w,
/posts/iot4-heislberg/menuqttool_hu_34ed007c4f33bf3e.png 660w,
/posts/iot4-heislberg/menuqttool_hu_1d9e27c28f403a72.png 1280w" data-zoom-src=/posts/iot4-heislberg/menuqttool.png src=/posts/iot4-heislberg/menuqttool.png></figure></p><p>The app used CocoaMQTT to subscribe to the <code>heislberg/door_state</code> topic and mapped each state to an emoji. The fun part: You could configure it to run shell commands on state changes, so you could theoretically hook it up to anything - notifications, scripts, whatever automation your heart desired.</p><p>If you by chance ever happen to need a macOS menu bar app that shows toilet occupancy, feel free to use it:</p><div class=github-card-wrapper><a id=github-27ecb1da452c959ab0d82af73ece69e4 target=_blank href=https://github.com/rolbk/MenuQTTool class=cursor-pointer><div class="w-full md:w-auto p-0 m-0 border border-neutral-200 dark:border-neutral-700 border rounded-md shadow-2xl"><div class="w-full nozoom"><img src=https://opengraph.githubassets.com/0/EmanuelMairoll/MenuQTTool alt="GitHub Repository Thumbnail" class="nozoom mt-0 mb-0 w-full h-full object-cover"></div><div class="w-full md:w-auto pt-3 p-5"><div class="flex items-center"><span class="text-2xl text-neutral-800 dark:text-neutral mr-[10px]"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><div id=github-27ecb1da452c959ab0d82af73ece69e4-full_name class="m-0 font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral">rolbk/MenuQTTool</div></div><p id=github-27ecb1da452c959ab0d82af73ece69e4-description class="m-0 mt-2 text-md text-neutral-800 dark:text-neutral">Display MQTT Messages in your MacOS Status Bar</p><div class="m-0 mt-2 flex items-center"><span class="mr-1 inline-block h-3 w-3 rounded-full" style=background-color:#f05138></span><div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">Swift</div><span class="text-md mr-1 text-neutral-800 dark:text-neutral"><span class="relative block icon"><svg viewBox="0 0 576 512"><path fill="currentColor" d="M287.9.0C297.1.0 305.5 5.25 309.5 13.52L378.1 154.8l153.3 22.7C540.4 178.8 547.8 185.1 550.7 193.7 553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4l26.3 155.5C461.4 492.9 457.7 502.1 450.2 507.4 442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9 150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4 118.2 502.1 114.5 492.9 115.1 483.9l27.1-155.5L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7 28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8 266.3 13.52C270.4 5.249 278.7.0 287.9.0zm0 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9 184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7l105.2-56.2C283.7 383.7 292.2 383.7 299.2 387.5l105.2 56.2-20.2-119.6C382.9 316.4 385.5 308.5 391 303l85.9-85.1-118.3-17.4C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg></span></span><div id=github-27ecb1da452c959ab0d82af73ece69e4-stargazers class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">1</div><span class="text-md mr-1 text-neutral-800 dark:text-neutral"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M80 104c13.3.0 24-10.7 24-24S93.3 56 80 56 56 66.7 56 80s10.7 24 24 24zm80-24c0 32.8-19.7 61-48 73.3V192c0 17.7 14.3 32 32 32H304c17.7.0 32-14.3 32-32V153.3C307.7 141 288 112.8 288 80c0-44.2 35.8-80 80-80s80 35.8 80 80c0 32.8-19.7 61-48 73.3V192c0 53-43 96-96 96H256v70.7c28.3 12.3 48 40.5 48 73.3.0 44.2-35.8 80-80 80s-80-35.8-80-80c0-32.8 19.7-61 48-73.3V288H144c-53 0-96-43-96-96V153.3C19.7 141 0 112.8.0 80 0 35.8 35.8.0 80 0s80 35.8 80 80zm208 24c13.3.0 24-10.7 24-24s-10.7-24-24-24-24 10.7-24 24 10.7 24 24 24zM248 432c0-13.3-10.7-24-24-24s-24 10.7-24 24 10.7 24 24 24 24-10.7 24-24z"/></svg></span></span><div id=github-27ecb1da452c959ab0d82af73ece69e4-forks class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">0</div></div></div></div><script async type=text/javascript src=/js/fetch-repo.min.8dc62397739c6bad3fd13945b87f251ff474c15ca4745cc6af8e12276050ddef337daedf284a830acbb2e456c9f599e2220477a38807ae76b4a342acdbe071d3.js integrity="sha512-jcYjl3Oca60/0TlFuH8lH/R0wVykdFzGr44SJ2BQ3e8zfa7fKEqDCsuy5FbJ9ZniIgR3o4gHrna0o0Ks2+Bx0w==" data-repo-url=https://api.github.com/repos/EmanuelMairoll/MenuQTTool data-repo-id=github-27ecb1da452c959ab0d82af73ece69e4></script></a></div><h3 class="relative group">Random ESPs<div id=random-esps class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#random-esps aria-label=Anchor>#</a></span></h3><p>I had a few spare Wemos D1 mini boards lying around, so I flashed them with a simple ESPHome config that showed the toilet status on the small onboard LED - off for free, on for occupied. Dangling on their small USB cables, they found homes in various places around the office - under desks, on shelves, wherever someone might glance at them and get a quick status update.</p><h3 class="relative group">The ON AIR Sign<div id=the-on-air-sign class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-on-air-sign aria-label=Anchor>#</a></span></h3><p>Lastly, I had grand plans for a huge &ldquo;ON AIR&rdquo; sign that would light up when occupied. You know, the classic red broadcasting light that every podcast studio has - except ours would indicate a very different kind of live performance.</p><p>I&rsquo;d already sourced everything: a vintage-style LED sign from Amazon, an ESP8266 based relay module to control it from AliExpress, and I&rsquo;d even started writing the ESPHome config for it.</p><p>The vision was clear - a big, unapologetic beacon of toilet occupancy that would finally bring our bathroom monitoring system out of the shadows (or walls, in this case).</p><p>Subtle? No. Effective? Absolutely.</p><p>Sadly, I left the company before installation day arrived. But, somewhere in my basement, buried in a box of electronics parts, that sign still waits for its moment of glory.</p><h2 class="relative group">The Legacy<div id=the-legacy class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-legacy aria-label=Anchor>#</a></span></h2><p>Before I left, the system had been running flawlessly for months. It processed over 15,000 &ldquo;transactions.&rdquo; The average occupancy was 6.3 minutes. Peak usage was Wednesday at 03:30 PM (after the all-hands meeting with a lot of coffee).</p><p>The beautiful thing is that the system might still be running. Hidden in the walls, an ESP32 silently monitoring magnetic fields, broadcasting to an MQTT topic that maybe nobody subscribes to anymore. A digital ghost of over-engineering past.</p><hr><p><em>This is Part 4 of my &ldquo;Unnecessary Home Office Automation&rdquo; series. All names have been changed to protect the guilty. No toilets were harmed in the making of this project. The CEO eventually found out, and found it pretty funny after all. Privacy concerns were&mldr; addressed retroactively.</em></p></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt="Emanuel Mairoll" src=/img/author_hu_17fff41dbcaade56.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Emanuel Mairoll</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Forward & Reverse Engineer</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/rolbk/ target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/rolbk/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:sigmoid_flavors_0u@icloud.com target=_blank aria-label=Envelope rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M48 64C21.5 64 0 85.5.0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4.0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4.0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3.0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8.0L0 176z"/></svg></span></span></a></div></div></div></div><div class=mb-10></div><details class="mt-2 mb-5 overflow-hidden rounded-lg ltr:ml-0 ltr:pl-5 rtl:mr-0 rtl:pr-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">The Open Source Smart Home -
This article is part of a series.</summary><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot1-sofa/>Part 1:
The Internet of Furniture</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot2-window/>Part 2:
The Internet of Roof Windows</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot3-door/>Part 3:
The Internet of Entrance Doors</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">Part 4:
This Article</div></details></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_posts/iot4-heislberg/index.md data-oid-likes=likes_posts/iot4-heislberg/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/iot3-door/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">The Internet of Entrance Doors</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-08-12T00:00:00+00:00>12 August 2023</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/posts/412ctf-heap-meanu/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">EPFL CS412 CTF – HEAP-MEANU</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-04-02T00:00:00+00:00>2 April 2025</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/acknowledgements/ title=Acknowledgements>Acknowledgements</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/privacy/ title="Privacy Statement">Privacy</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/polyring/ title=Polyring>Polyring</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Emanuel Mairoll</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://rolbk.com/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>