<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>The Internet of Entrance Doors &#183; [root@rolbk.com]#</title><meta name=title content="The Internet of Entrance Doors &#183; [root@rolbk.com]#"><meta name=description content="How I taught my apartment's entrance door to recognize me and open automatically. A surprisingly practical tale of BLE authentication, hidden ESPs, and the occasional accidental door opening while driving by."><meta name=keywords content="IoT,Home Assistant,ESPHome,BLE,iOS Shortcuts,Door Automation,"><link rel=canonical href=https://rolbk.com/posts/iot3-door/><link type=text/css rel=stylesheet href=/css/main.bundle.min.db15651319416dc23c09716c6bfad333663de46f0b1634dd77228e3d4e350ca3fbb38193699e7e36ded41b245e010f69c5d8428ef1646be3b37248366e6ee201.css integrity="sha512-2xVlExlBbcI8CXFsa/rTM2Y95G8LFjTddyKOPU41DKP7s4GTaZ5+Nt7UGyReAQ9pxdhCjvFka+Ozckg2bm7iAQ=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.a187118b41a60744310065c567365de85730c8495301d0ebae41810cc6f7a47432b1de7d4f3b11338959f1ac50c266be6b4b73acf6bf770016eb59b602cc1aa0.js integrity="sha512-oYcRi0GmB0QxAGXFZzZd6FcwyElTAdDrrkGBDMb3pHQysd59TzsRM4lZ8axQwma+a0tzrPa/dwAW61m2AswaoA==" data-copy=Copy data-copied=Copied></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://rolbk.com/posts/iot3-door/"><meta property="og:site_name" content="[root@rolbk.com]#"><meta property="og:title" content="The Internet of Entrance Doors"><meta property="og:description" content="How I taught my apartment’s entrance door to recognize me and open automatically. A surprisingly practical tale of BLE authentication, hidden ESPs, and the occasional accidental door opening while driving by."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-12T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-12T00:00:00+00:00"><meta property="article:tag" content="IoT"><meta property="article:tag" content="Home Assistant"><meta property="article:tag" content="ESPHome"><meta property="article:tag" content="BLE"><meta property="article:tag" content="IOS Shortcuts"><meta property="article:tag" content="Door Automation"><meta property="og:image" content="https://rolbk.com/posts/iot3-door/featured.webp"><meta property="og:see_also" content="https://rolbk.com/posts/iot4-heislberg/"><meta property="og:see_also" content="https://rolbk.com/posts/iot2-window/"><meta property="og:see_also" content="https://rolbk.com/posts/iot1-sofa/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rolbk.com/posts/iot3-door/featured.webp"><meta name=twitter:title content="The Internet of Entrance Doors"><meta name=twitter:description content="How I taught my apartment’s entrance door to recognize me and open automatically. A surprisingly practical tale of BLE authentication, hidden ESPs, and the occasional accidental door opening while driving by."><meta name=twitter:image content="https://rolbk.com/posts/iot3-door/featured.webp"><meta property="og:image" content="https://rolbk.com/posts/iot3-door/featured.webp"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"The Internet of Entrance Doors","headline":"The Internet of Entrance Doors","abstract":"How I taught my apartment\u0026rsquo;s entrance door to recognize me and open automatically. A surprisingly practical tale of BLE authentication, hidden ESPs, and the occasional accidental door opening while driving by.","inLanguage":"en","url":"https:\/\/rolbk.com\/posts\/iot3-door\/","author":{"@type":"Person","name":"Emanuel Mairoll"},"copyrightYear":"2023","dateCreated":"2023-08-12T00:00:00\u002b00:00","datePublished":"2023-08-12T00:00:00\u002b00:00","dateModified":"2023-08-12T00:00:00\u002b00:00","keywords":["IoT","Home Assistant","ESPHome","BLE","iOS Shortcuts","Door Automation"],"mainEntityOfPage":"true","wordCount":"2612"}]</script><meta name=author content="Emanuel Mairoll"><link href=https://github.com/rolbk/ rel=me><link href=https://www.linkedin.com/in/rolbk/ rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px] z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 pt-[2px] pr-0 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">[root@rolbk.com]#</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Posts>Posts</p></a><a href=/projects/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title="Under Construction ;-)">Projects</p></a><a href=/resume/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Resume>Resume</p></a><a href=https://github.com/rolbk target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title></p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Posts>Posts</p></a></li><li class=mt-1><a href=/projects/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title="Under Construction ;-)">Projects</p></a></li><li class=mt-1><a href=/resume/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Resume>Resume</p></a></li><li class=mt-1><a href=https://github.com/rolbk target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li></ul></div></div></div></div></div></div><script type=text/javascript src=/js/background-blur.min.0ad33cb9c066f652728b2cc09c9ceaf32645544f48e8b6b38f120d86f433ed997da275a49e6151fe0176430c45376812708d84727f3f969101fb44a4345b3f34.js integrity="sha512-CtM8ucBm9lJyiyzAnJzq8yZFVE9I6LazjxINhvQz7Zl9onWknmFR/gF2QwxFN2gScI2Ecn8/lpEB+0SkNFs/NA==" data-target-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src=/posts/iot3-door/featured_hu_efa75e19cf79061.webp alt="Background Image" class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script type=text/javascript src=/js/background-blur.min.0ad33cb9c066f652728b2cc09c9ceaf32645544f48e8b6b38f120d86f433ed997da275a49e6151fe0176430c45376812708d84727f3f969101fb44a4345b3f34.js integrity="sha512-CtM8ucBm9lJyiyzAnJzq8yZFVE9I6LazjxINhvQz7Zl9onWknmFR/gF2QwxFN2gScI2Ecn8/lpEB+0SkNFs/NA==" data-target-id=background-blur data-image-id=background-image data-image-url=/posts/iot3-door/featured.webp></script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">The Internet of Entrance Doors</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-08-12T00:00:00+00:00>12 August 2023</time><span class="px-2 text-primary-500">&#183;</span><span>2612 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">13 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] mr-2" href=/tags/iot/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">IoT
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/home-assistant/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Home Assistant
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/esphome/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">ESPHome
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/ble/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">BLE
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/ios-shortcuts/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">IOS Shortcuts
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/tags/door-automation/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Door Automation</span></span></a></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#the-problem-keys-are-so-last-century>The Problem: Keys Are So Last Century</a></li><li><a href=#the-plan-a-three-part-system>The Plan: A Three-Part System</a></li><li><a href=#act-i-the-intercom-surgery>Act I: The Intercom Surgery</a><ul><li><a href=#the-reconnaissance>The Reconnaissance</a></li><li><a href=#the-clean-installation>The Clean Installation</a></li></ul></li><li><a href=#act-ii-the-authentication-dilemma>Act II: The Authentication Dilemma</a><ul><li><a href=#the-failed-approaches>The Failed Approaches</a></li><li><a href=#the-breakthrough-ble-authentication>The Breakthrough: BLE Authentication</a></li></ul></li><li><a href=#act-iii-the-ble-key-system>Act III: The BLE Key System</a><ul><li><a href=#the-protocol>The Protocol</a></li><li><a href=#the-sensor-hardware>The Sensor Hardware</a></li><li><a href=#the-software>The Software</a></li><li><a href=#the-ios-app>The iOS App</a></li></ul></li><li><a href=#putting-everything-together>Putting everything together</a></li><li><a href=#living-with-magic-doors>Living with Magic Doors</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#the-problem-keys-are-so-last-century>The Problem: Keys Are So Last Century</a></li><li><a href=#the-plan-a-three-part-system>The Plan: A Three-Part System</a></li><li><a href=#act-i-the-intercom-surgery>Act I: The Intercom Surgery</a><ul><li><a href=#the-reconnaissance>The Reconnaissance</a></li><li><a href=#the-clean-installation>The Clean Installation</a></li></ul></li><li><a href=#act-ii-the-authentication-dilemma>Act II: The Authentication Dilemma</a><ul><li><a href=#the-failed-approaches>The Failed Approaches</a></li><li><a href=#the-breakthrough-ble-authentication>The Breakthrough: BLE Authentication</a></li></ul></li><li><a href=#act-iii-the-ble-key-system>Act III: The BLE Key System</a><ul><li><a href=#the-protocol>The Protocol</a></li><li><a href=#the-sensor-hardware>The Sensor Hardware</a></li><li><a href=#the-software>The Software</a></li><li><a href=#the-ios-app>The iOS App</a></li></ul></li><li><a href=#putting-everything-together>Putting everything together</a></li><li><a href=#living-with-magic-doors>Living with Magic Doors</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><details class="mt-2 mb-5 overflow-hidden rounded-lg ltr:ml-0 ltr:pl-5 rtl:mr-0 rtl:pr-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">The Open Source Smart Home -
This article is part of a series.</summary><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot1-sofa/>Part 1:
The Internet of Furniture</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot2-window/>Part 2:
The Internet of Roof Windows</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">Part 3:
This Article</div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot4-heislberg/>Part 4:
Heislberg: The Internet of Toilets</a></div></details><div class="article-content max-w-prose mb-20"><div class="lead text-neutral-500 dark:text-neutral-400 !mb-9 text-xl">Or: How I achieved the ultimate lazy person&rsquo;s dream - never fumbling for keys again</div><p>Compared to my previous adventures in this series - reverse-engineering a proprietary sofa protocol and decoding decades-old roof window communications - this project was refreshingly straightforward. No ladder acrobatics, no fried transistors, no proprietary bus protocols from the early 2000s.</p><p>Just a simple goal: Make my entrance door open automatically when I approach it. You know, like in Star Trek, but for a 1970s Austrian apartment building.</p><p><strong><em>Stories from the Open Source Smart Home - Part 3</em></strong></p><hr><h2 class="relative group">The Problem: Keys Are So Last Century<div id=the-problem-keys-are-so-last-century class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-problem-keys-are-so-last-century aria-label=Anchor>#</a></span></h2><p>My Salzburg flat came with a modern keypad system for the building&rsquo;s entrance door. Great in theory - no keys to lose, just remember a code. Future.</p><p>Until you try punching in a 6-digit code while balancing groceries, in the rain. And heaven forbid you get one digit wrong and have to start over while your frozen foods slowly defrost. Future, this was not.</p><p>But: The intercom handset system in my flat had a button to buzz people in. Every time I approached the building, loaded down with shopping bags, I&rsquo;d think: &ldquo;If only I could press that button from outside.&rdquo; Then I&rsquo;d think: &ldquo;Wait, I literally automate things for fun.&rdquo;</p><p>The itch was back.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=intercom srcset="/posts/iot3-door/intercom_hu_d4fe0913ed6cacee.webp 330w,
/posts/iot3-door/intercom_hu_2a47ef7e54d43766.webp 660w,
/posts/iot3-door/intercom_hu_b7416f8a253244a2.webp 1280w" data-zoom-src=/posts/iot3-door/intercom.webp src=/posts/iot3-door/intercom.webp></figure></p><h2 class="relative group">The Plan: A Three-Part System<div id=the-plan-a-three-part-system class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-plan-a-three-part-system aria-label=Anchor>#</a></span></h2><p>The system would need three parts:</p><ol><li><strong>Door Opener</strong>: Something to physically press the intercom button</li><li><strong>Key Detector</strong>: A sensor near the entrance to detect my approach</li><li><strong>Key App</strong>: Something on my phone to authenticate that it&rsquo;s actually me</li></ol><p>Simple enough. What could possibly go wrong?</p><p>(Spoiler: I accidentally opened my door while driving past my building. We&rsquo;ll get to that.)</p><h2 class="relative group">Act I: The Intercom Surgery<div id=act-i-the-intercom-surgery class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#act-i-the-intercom-surgery aria-label=Anchor>#</a></span></h2><p>First step: Figure out how to electronically &ldquo;press&rdquo; the intercom button. While I could have gone the crude route with a SwitchBot or similar mechanical button pusher, where&rsquo;s the elegance in that? Plus, I have this weird compulsion to open up every electronic device I own.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=intercom_manual srcset="/posts/iot3-door/intercom_manual_hu_fa57ff4bddf679e.jpg 330w,
/posts/iot3-door/intercom_manual_hu_6a2f6f0163cdd7da.jpg 660w,
/posts/iot3-door/intercom_manual_hu_f0a44785751cbedf.jpg 1280w" data-zoom-src=/posts/iot3-door/intercom_manual.jpg src=/posts/iot3-door/intercom_manual.jpg></figure>Image source: <a href=https://interfoni.rs/wp-content/uploads/2019/08/Bticino-334202-stari-stil-5-zica-interfonska-slusalica-sema-prikljucaka.pdf target=_blank>This Manual</a></p><h3 class="relative group">The Reconnaissance<div id=the-reconnaissance class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-reconnaissance aria-label=Anchor>#</a></span></h3><p>The intercom was a BTICINO BTI334202 SPRINT - a fairly standard unit with four buttons for various functions (which I never quite figured out or used), plus one satisfying blue button for opening the door. Two screws and three plastic clips later I was looking at a surprisingly simple setup. A 5-wire bus system connected everything, and shorting the right two wires would trigger the door.</p><p>Perfect. All I needed to do was short these two contacts, and the door would open.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=intercom_internals_front srcset="/posts/iot3-door/intercom_internals_front_hu_e0078c221961a485.webp 330w,
/posts/iot3-door/intercom_internals_front_hu_1a014c64501145c8.webp 660w,
/posts/iot3-door/intercom_internals_front_hu_9c906db7c203edf1.webp 1280w" data-zoom-src=/posts/iot3-door/intercom_internals_front.webp src=/posts/iot3-door/intercom_internals_front.webp></figure><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=intercom_internals_back srcset="/posts/iot3-door/intercom_internals_back_hu_5cbc30b52a43cc5c.webp 330w,
/posts/iot3-door/intercom_internals_back_hu_6ee64637cc21196.webp 660w,
/posts/iot3-door/intercom_internals_back_hu_a3a741c90d79f672.webp 1280w" data-zoom-src=/posts/iot3-door/intercom_internals_back.webp src=/posts/iot3-door/intercom_internals_back.webp></figure></p><p>One convenient feature of this system are the screw terminals - no soldering required. I just loosened the terminals, added two additional wires from an ethernet cable I had laying around, and tightened them back down. Simple, clean, and (importantly) reversible.</p><h3 class="relative group">The Clean Installation<div id=the-clean-installation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-clean-installation aria-label=Anchor>#</a></span></h3><p>For tidiness (and probably some deep-seated need to make everything look professional), I decided to run the wires through the wall. Lucky for me, the intercom already had cables feeding into the wall cavity, and there was an existing cable duct that ran directly behind where my couch would sit. Even better - that duct was still empty, so pulling the cable through it was a breeze with my pulling rod. Sometimes the automation gods smile upon you.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=intercom_cable srcset="/posts/iot3-door/intercom_cable_hu_b6eb4e4e7dc9c82e.webp 330w,
/posts/iot3-door/intercom_cable_hu_7184581e14b00219.webp 660w,
/posts/iot3-door/intercom_cable_hu_738a820c896a983.webp 1280w" data-zoom-src=/posts/iot3-door/intercom_cable.webp src=/posts/iot3-door/intercom_cable.webp></figure></p><p>On the other side, behind the couch, I connected the ethernet wires to an ESP32-GATEWAY board with a simple relay module. When the relay closes, it shorts the wires, &ldquo;pressing&rdquo; the button. The ESPHome configuration couldn&rsquo;t be simpler:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>esphome</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>intercom</span>
</span></span><span style=display:flex><span><span style=color:#f92672>esp32</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>board</span>: <span style=color:#ae81ff>esp32-gateway</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>framework</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>arduino</span>
</span></span><span style=display:flex><span><span style=color:#f92672>logger</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>&lt;API_PASSWORD&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>ota</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>&lt;OTA_PASSWORD&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>ethernet</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>LAN8720</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mdc_pin</span>: <span style=color:#ae81ff>GPIO23</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mdio_pin</span>: <span style=color:#ae81ff>GPIO18</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>clk_mode</span>: <span style=color:#ae81ff>GPIO0_IN</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>phy_addr</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>switch</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>gpio</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pin</span>: <span style=color:#ae81ff>GPIO32</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Door Opener&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>door_opener</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>on_turn_on</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>then</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>delay</span>: <span style=color:#ae81ff>0.</span><span style=color:#ae81ff>2s</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>switch.turn_off</span>: <span style=color:#ae81ff>door_opener</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>binary_sensor</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>gpio</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pin</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>number</span>: <span style=color:#ae81ff>GPIO34</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>inverted</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>button_onboard</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>on_press</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>then</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>switch.turn_on</span>: <span style=color:#ae81ff>door_opener</span>
</span></span></code></pre></div><p>The 0.2-second delay mimics a human button press - long enough to register, short enough not to annoy the door mechanism.</p><p>ESPHome automatically integrated with Home Assistant, which then exposed it through Homebridge to HomeKit. Within minutes, I could open my entrance door with Siri.</p><p>&ldquo;Hey Siri, open the door.&rdquo;
<em>Bzzzzt.</em>
Magic.</p><h2 class="relative group">Act II: The Authentication Dilemma<div id=act-ii-the-authentication-dilemma class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#act-ii-the-authentication-dilemma aria-label=Anchor>#</a></span></h2><p>Now, having a button on my phone to open the door is nice, but the dream was hands-free operation. The door should just <em>know</em> it&rsquo;s me approaching and open automatically. So, how to detect me?</p><h3 class="relative group">The Failed Approaches<div id=the-failed-approaches class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-failed-approaches aria-label=Anchor>#</a></span></h3><p><strong>Attempt #1: WiFi Detection</strong>
iOS Shortcuts can trigger when connecting to specific WiFi networks. It sounds perfect in theory: Trigger the door opener when my phone connects to my home WiFi.
However, the Problems with this became immediately apparent:</p><ul><li>The WiFi sometimes reaches the surrounding area (hello, random door openings)</li><li>The WiFi sometimes doesn&rsquo;t reach the entrance (hello, waiting in the rain)</li><li>The Latency between connecting and the shortcut running is unpredictable in general</li></ul><p><strong>Attempt #2: Geolocation</strong>
iOS also supports location-based automations. So: Set up a geofence around my building, trigger when entering. What could go wrong?</p><p>Well, it turns out GPS resolution is sometimes&mldr; optimistic. One time when I drove past my building on the way to somewhere my grandparents, the automation triggered. Twenty minutes later, I realized my building&rsquo;s door had been wide open the entire time. Well, that was a fun drive back.</p><p>Geofencing: Not precise enough for entrance doors, apparently.</p><h3 class="relative group">The Breakthrough: BLE Authentication<div id=the-breakthrough-ble-authentication class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-breakthrough-ble-authentication aria-label=Anchor>#</a></span></h3><p>What I needed was something with:</p><ul><li>Short range (5-10 meters maximum)</li><li>Fast detection</li><li>Secure enough that neighbors couldn&rsquo;t accidentally trigger it</li><li>Works in iOS background mode (the killer requirement)</li></ul><p>Enter Bluetooth Low Energy (BLE). It turns out iOS has surprisingly good support for BLE in shortcuts - originally designed for medical devices and fitness trackers, but perfectly suited for proximity-based authentication as well.</p><p>The concept was straightforward: place a BLE beacon near the door that broadcasts a challenge, have my phone respond with the correct response, door opens. Like a cryptographic handshake, but for doors.</p><h2 class="relative group">Act III: The BLE Key System<div id=act-iii-the-ble-key-system class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#act-iii-the-ble-key-system aria-label=Anchor>#</a></span></h2><h3 class="relative group">The Protocol<div id=the-protocol class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-protocol aria-label=Anchor>#</a></span></h3><p>I designed a simple HMAC-based authentication system:</p><ol><li><strong>The ESP32 beacon</strong> continuously advertises a BLE service with a &ldquo;challenge&rdquo; characteristic</li><li><strong>The challenge</strong> is a hash of the current time (rounded to 1-second intervals) plus a salt</li><li><strong>The phone</strong> reads this challenge, computes HMAC-SHA256(challenge + shared_secret)</li><li><strong>The phone</strong> writes this response back to a &ldquo;response&rdquo; characteristic</li><li><strong>The ESP32</strong> validates the response and triggers the door if correct</li></ol><h3 class="relative group">The Sensor Hardware<div id=the-sensor-hardware class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-sensor-hardware aria-label=Anchor>#</a></span></h3><p>For the BLE beacon, I needed something that could run ESPHome, support Bluetooth operations, and sit inconspicuously in the building entrance without looking like a surveillance device.</p><p>The Shelly Plug Plus S turned out to be the perfect candidate for this. It&rsquo;s one of those smart plugs that Shelly makes for home automation, but what makes it special for hackers is that Shelly deliberately makes their devices reflashable. They add programming headers, don&rsquo;t lock down the bootloader, and even document the pinouts. It&rsquo;s like they <em>want</em> us to hack their products (and honestly, that&rsquo;s why I keep buying them). The Plus S model uses an ESP32, giving plenty of power for BLE operations while still fitting in a compact plug form factor that wouldn&rsquo;t raise eyebrows in the building entrance.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt=shelly srcset="/posts/iot3-door/shelly_hu_4abd0ac40e45e00b.png 330w,
/posts/iot3-door/shelly_hu_ee62d14c6fdbceef.png 660w,
/posts/iot3-door/shelly_hu_7af76e855863002a.png 1280w" data-zoom-src=/posts/iot3-door/shelly.png src=/posts/iot3-door/shelly.png></figure>Image source: <a href="https://www.shelly.com/products/shelly-plus-plug-s-white?variant=56273485365597" target=_blank>Shelly Online Store</a></p><p>After cracking it open and finding the clearly labeled programming headers, flashing it with custom firmware was a breeze. Five minutes later, I had a fully functional smart plug running ESPHome.</p><h3 class="relative group">The Software<div id=the-software class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-software aria-label=Anchor>#</a></span></h3><p>The ESPHome configuration is surprisingly simple - Most of the complexity is hidden in the <code>esp32_ble_key</code> section. It&rsquo;s a custom C++ component that implements the time-based challenge-response authentication.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>esphome</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>bouncer</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>ESP32</span>
</span></span><span style=display:flex><span><span style=color:#f92672>logger</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>api</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>&lt;API_PASSWORD&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>wifi</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ssid</span>: <span style=color:#ae81ff>&lt;WIFI_SSID&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>&lt;WIFI_PASSWORD&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>fast_connect</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>time</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>homeassistant</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>homeassistant_time</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>external_components</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>source</span>: <span style=color:#ae81ff>my_components</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>esp32_ble_key</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>authorizer</span>: <span style=color:#ae81ff>key_detected</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>time_source</span>: <span style=color:#ae81ff>homeassistant_time</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>secret</span>: <span style=color:#ae81ff>&lt;SHARED_SECRET&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>binary_sensor</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>template</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Key Detected&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>key_detected</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>device_class</span>: <span style=color:#ae81ff>presence</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>filters</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>delayed_off</span>: <span style=color:#ae81ff>20s</span>
</span></span></code></pre></div><p>Conveniently, the Shelly Plug barely reached my home WiFi from the entrance. Being permanently installed there made the connection reliable enough to consistently report back to Home Assistant.</p><p>Not shown here is the additional logic to keep the smart plug working as a power outlet, which is trivial in ESPHome and a nice bonus feature. We don&rsquo;t want to lose that functionality ;)</p><h4 class="relative group">The <code>esp32_ble_key</code> Custom Component<div id=the-esp32_ble_key-custom-component class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-esp32_ble_key-custom-component aria-label=Anchor>#</a></span></h4><p>ESPHome has a neat feature where you can write your own components in C++ when the built-in ones don&rsquo;t cut it. These live in a <code>my_components</code> folder and extend ESPHome&rsquo;s functionality with whatever crazy protocol or hardware you need to support. Think of them as plugins that integrate seamlessly with the YAML configuration - you get all the benefits of ESPHome (OTA updates, Home Assistant integration, logging) while having the full power (and complexity) of C++.</p><p>Every second, the component generates a new challenge by hashing the current timestamp with a salt, then broadcasts this via a BLE characteristic. When a phone connects and reads the challenge, it calculates SHA256(challenge + shared_secret) and writes the response back. The ESP validates this response and triggers the door:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>void</span> ESP32BLEKeyComponent<span style=color:#f92672>::</span>process_incoming_data_(
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>uint8_t</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&amp;</span>data
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Calculate expected: SHA256(challenge + secret)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  std<span style=color:#f92672>::</span>string challenge_plus_secret <span style=color:#f92672>=</span> 
</span></span><span style=display:flex><span>    format_hex(<span style=color:#66d9ef>this</span><span style=color:#f92672>-&gt;</span>challenge_) <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>-&gt;</span>secret_;
</span></span><span style=display:flex><span>  SHA256 sha;
</span></span><span style=display:flex><span>  sha.update(challenge_plus_secret);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>auto</span> expected_hash <span style=color:#f92672>=</span> sha.digest();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (data <span style=color:#f92672>==</span> expected_hash_vec) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Valid response - trigger door opener!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>-&gt;</span>authorizer_<span style=color:#f92672>-&gt;</span>publish_state(true);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>-&gt;</span>authorizer_<span style=color:#f92672>-&gt;</span>publish_state(false);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Also check previous challenge for time drift...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>The challenge rotates every second, so intercepted responses become useless almost immediately. The component also accepts the previous challenge (up to 3 seconds old) to handle processing delay.</p><h4 class="relative group">Security Considerations<div id=security-considerations class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#security-considerations aria-label=Anchor>#</a></span></h4><p>If you are familiar with secure ranging, you might suspect this isn&rsquo;t bulletproof. And you&rsquo;d be right.</p><p>The obvious vulnerability here is a relay attack. Someone could intercept the BLE challenge-response authentication, relay it to an accomplice near my phone, get the valid response, and relay it back to open the door. The timeout window doesn&rsquo;t help much when radio waves move at the speed of light.</p><p>For truly secure authentication, you&rsquo;d need UWB (Ultra-Wideband) secure ranging that measures time-of-flight - basically using physics to prove the phone is actually there, not being relayed. Many vendors do this with their car keys, measuring the exact nanoseconds it takes for radio waves to bounce back, which can&rsquo;t be faked or relayed, at least if you obey the laws of special relativity. It&rsquo;s elegant, secure - and completely overkill for my use case.</p><p>Let&rsquo;s be real here. This is rural Austria. My neighbors literally keep their doors unlocked. The elderly couple next door hasn&rsquo;t locked their door since 1987. Someone sophisticated enough to perform a BLE relay attack would probably just&mldr; follow another resident in. The threat model isn&rsquo;t sophisticated attackers - it&rsquo;s &ldquo;I don&rsquo;t want to fish for keys while carrying groceries.&rdquo;</p><p>Safe enough.</p><h3 class="relative group">The iOS App<div id=the-ios-app class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#the-ios-app aria-label=Anchor>#</a></span></h3><p>The most constrained part of the whole system was iOS. Background Bluetooth in iOS Shortcuts is&mldr; quirky. You get 30 seconds of runtime maximum, no UI, limited API access, and if you do anything Apple doesn&rsquo;t like, your shortcut silently fails.</p><p>I first tried to create it as embedded script in one of the many JavaScript for Automation apps (Scriptable, etc). But these apps have their own quirks, and getting BLE to work reliably was a nightmare. After several failed attempts, I settled on using a custom iOS App with a embedded Shortcut that implements authentication logic.</p><p>When triggered, the shortcut:</p><ol><li>Scans for BLE devices with the specific service UUID</li><li>Connects to the first one found</li><li>Reads the challenge characteristic</li><li>Computes the response</li><li>Writes it back</li><li>Disconnects</li><li>Returns success/failure</li></ol><p>In Swift, the core BLE logic looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BLEClient</span>: NSObject, CBCentralManagerDelegate, CBPeripheralDelegate, @unchecked Sendable {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> targetServiceUUID = CBUUID(string: <span style=color:#e6db74>&#34;&lt;SERVICE-UUID&gt;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> readCharacteristicUUID = CBUUID(string: <span style=color:#e6db74>&#34;&lt;REQUEST-UUID&gt;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> writeCharacteristicUUID = CBUUID(string: <span style=color:#e6db74>&#34;&lt;RESPONSE-UUID&gt;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> secret: String = &lt;INJECTED<span style=color:#f92672>-</span>VIA<span style=color:#f92672>-</span>SHORTCUT&gt;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> targetPeripheral: CBPeripheral?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @MainActor <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>scanForPeripherals</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> centralManager.state == .poweredOn {
</span></span><span style=display:flex><span>            centralManager.scanForPeripherals(withServices: [targetServiceUUID], options: <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>centralManager</span>(<span style=color:#66d9ef>_</span> central: CBCentralManager, didDiscover peripheral: CBPeripheral, advertisementData: [String : Any], rssi RSSI: NSNumber) {
</span></span><span style=display:flex><span>        Task { @MainActor <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>            targetPeripheral = peripheral
</span></span><span style=display:flex><span>            centralManager.stopScan()
</span></span><span style=display:flex><span>            centralManager.connect(peripheral, options: <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>centralManager</span>(<span style=color:#66d9ef>_</span> central: CBCentralManager, didConnect peripheral: CBPeripheral) {
</span></span><span style=display:flex><span>        peripheral.delegate = <span style=color:#66d9ef>self</span>
</span></span><span style=display:flex><span>        peripheral.discoverServices([targetServiceUUID])
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>peripheral</span>(<span style=color:#66d9ef>_</span> peripheral: CBPeripheral, didDiscoverServices error: Error?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>let</span> services = peripheral.services <span style=color:#66d9ef>else</span> { <span style=color:#66d9ef>return</span> }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> service <span style=color:#66d9ef>in</span> services <span style=color:#66d9ef>where</span> service.uuid == targetServiceUUID {
</span></span><span style=display:flex><span>            peripheral.discoverCharacteristics([readCharacteristicUUID, writeCharacteristicUUID], <span style=color:#66d9ef>for</span>: service)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>peripheral</span>(<span style=color:#66d9ef>_</span> peripheral: CBPeripheral, didDiscoverCharacteristicsFor service: CBService, error: Error?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>let</span> characteristics = service.characteristics <span style=color:#66d9ef>else</span> { <span style=color:#66d9ef>return</span> }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> characteristic <span style=color:#66d9ef>in</span> characteristics {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> characteristic.uuid == readCharacteristicUUID {
</span></span><span style=display:flex><span>                peripheral.readValue(<span style=color:#66d9ef>for</span>: characteristic)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>peripheral</span>(<span style=color:#66d9ef>_</span> peripheral: CBPeripheral, didUpdateValueFor characteristic: CBCharacteristic, error: Error?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> value = characteristic.value, <span style=color:#f92672>!</span>value.isEmpty {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> dataString = value.map { String(format: <span style=color:#e6db74>&#34;%02hhx&#34;</span>, $0) }.joined()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> combinedString = dataString <span style=color:#f92672>+</span> secret
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> hash = sha256(data: combinedString) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> first22Bytes = hash.<span style=color:#66d9ef>prefix</span>(<span style=color:#ae81ff>22</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>let</span> peripheral = targetPeripheral,
</span></span><span style=display:flex><span>                      <span style=color:#66d9ef>let</span> service = peripheral.services?.first(<span style=color:#66d9ef>where</span>: { $0.uuid == targetServiceUUID }),
</span></span><span style=display:flex><span>                      <span style=color:#66d9ef>let</span> characteristic = service.characteristics?.first(<span style=color:#66d9ef>where</span>: { $0.uuid == writeCharacteristicUUID }) <span style=color:#66d9ef>else</span> { <span style=color:#66d9ef>return</span> }
</span></span><span style=display:flex><span>                peripheral.writeValue(first22Bytes, <span style=color:#66d9ef>for</span>: characteristic, type: .withResponse)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            ...
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>To avoid battery drain, the shortcut only runs when specific triggers occur:</p><ul><li>Disconnecting from CarPlay when around my (coarse) home location</li><li>Entering a (coarse) geofence around my building</li><li>Or when I manually trigger it from the control center (with hands still free)</li></ul><p>In order to bypass the 30 second limit, I run the shortcut multiple times in succession until it succeeds. Looping it 6 times gives me 3 minutes of runtime, which is more than enough time to get from my car to the door.</p><h2 class="relative group">Putting everything together<div id=putting-everything-together class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#putting-everything-together aria-label=Anchor>#</a></span></h2><p>Unlike my previous projects, installation was remarkably smooth:</p><ol><li><strong>Install the intercom controller</strong>: Already done, hidden behind the couch</li><li><strong>Deploy the BLE sensor</strong>: Plugged the reflashed Shelly into an outlet in the building entrance</li><li><strong>Configure Home Assistant</strong>: One simple automation:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>alias</span>: <span style=color:#e6db74>&#34;Open door when key detected&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>trigger</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>state</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>bouncer.key_detected</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>to</span>: <span style=color:#e6db74>&#39;on&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>action</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>service</span>: <span style=color:#ae81ff>switch.turn_on</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>entity_id</span>: <span style=color:#ae81ff>intercom.door_opener</span>
</span></span></code></pre></div></li><li><strong>Set up the iOS Shortcut</strong>: Create automation, add triggers, test</li></ol><p>Simple. Reliable. Almost boring in its straightforwardness.</p><h2 class="relative group">Living with Magic Doors<div id=living-with-magic-doors class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#living-with-magic-doors aria-label=Anchor>#</a></span></h2><p>It&rsquo;s been a year since installation, and I can report that having your door open automatically when you approach never gets old. There&rsquo;s something deeply satisfying about walking up to your building with arms full of groceries and having the door just&mldr; open.</p><p>Visitors are consistently amazed. &ldquo;Did you just open that with your phone?&rdquo; Well, yes, but also no. It&rsquo;s more like the door recognized me and decided I was worthy of entry.</p><p>Before I got used to it, sometimes even I got startled by the unexpected buzz of the door unlocking.</p><p>Future, this is.</p><p><strong>The Statistics:</strong></p><ul><li>Total door openings: 491</li><li>Success rate: ~98% (failures usually due to iOS being iOS)</li><li>Accidental openings after fixing geofence: 0</li><li>Time saved fumbling for keys: Incalculable</li></ul><p>This project lacks the reverse-engineering adventure of my previous exploits. However, sometimes the best home automation isn&rsquo;t about conquering impossible technical challenges. Sometimes it&rsquo;s about solving a simple, daily annoyance with exactly the right amount of engineering.</p><p>Every time I walk up to my building, hands full of groceries, and hear that satisfying bzzt as the door unlocks itself - that&rsquo;s when I remember why I love doing this.</p><p>Even if my neighbors think I&rsquo;m a wizard.</p><hr><p><em>This is Part 3 of my &ldquo;Stories from the Open Source Smart Home&rdquo; series. My landlord knows about it and thinks its black magic. The shared secret was rotated regularly (okay, I&rsquo;ve been meaning to rotate it for over six months). The system was cleanly removed when I moved out, leaving no trace except for one weird cable behind where the couch used to be.</em></p></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt="Emanuel Mairoll" src=/img/author_hu_17fff41dbcaade56.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Emanuel Mairoll</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Forward & Reverse Engineer</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/rolbk/ target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/rolbk/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:sigmoid_flavors_0u@icloud.com target=_blank aria-label=Envelope rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M48 64C21.5 64 0 85.5.0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4.0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4.0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3.0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8.0L0 176z"/></svg></span></span></a></div></div></div></div><div class=mb-10></div><details class="mt-2 mb-5 overflow-hidden rounded-lg ltr:ml-0 ltr:pl-5 rtl:mr-0 rtl:pr-5"><summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">The Open Source Smart Home -
This article is part of a series.</summary><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot1-sofa/>Part 1:
The Internet of Furniture</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot2-window/>Part 2:
The Internet of Roof Windows</a></div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">Part 3:
This Article</div><div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><a href=/posts/iot4-heislberg/>Part 4:
Heislberg: The Internet of Toilets</a></div></details></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_posts/iot3-door/index.md data-oid-likes=likes_posts/iot3-door/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/iot2-window/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">The Internet of Roof Windows</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-01-07T00:00:00+00:00>7 January 2023</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/posts/iot4-heislberg/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Heislberg: The Internet of Toilets</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2024-11-15T00:00:00+00:00>15 November 2024</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/acknowledgements/ title=Acknowledgements>Acknowledgements</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/privacy/ title="Privacy Statement">Privacy</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/polyring/ title=Polyring>Polyring</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Emanuel Mairoll</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://rolbk.com/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>